window.__require=function t(r,e,o){function i(a,c){if(!e[a]){if(!r[a]){var s=a.split("/");if(s=s[s.length-1],!r[s]){var h="function"==typeof __require&&__require;if(!c&&h)return h(s,!0);if(n)return n(s,!0);throw new Error("Cannot find module '"+a+"'")}a=s}var d=e[a]={exports:{}};r[a][0].call(d.exports,function(t){return i(r[a][1][t]||t)},d,d.exports,t,r,e,o)}return e[a].exports}for(var n="function"==typeof __require&&__require,a=0;a<o.length;a++)i(o[a]);return i}({main:[function(t,r,e){"use strict";cc._RF.push(r,"ae5f4SVpuxJHYAxP0LYQFwt","main");var o,i=this&&this.__extends||(o=function(t,r){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e])})(t,r)},function(t,r){function e(){this.constructor=t}o(t,r),t.prototype=null===r?Object.create(r):(e.prototype=r.prototype,new e)}),n=this&&this.__decorate||function(t,r,e,o){var i,n=arguments.length,a=n<3?r:null===o?o=Object.getOwnPropertyDescriptor(r,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,r,e,o);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(a=(n<3?i(a):n>3?i(r,e,a):i(r,e))||a);return n>3&&a&&Object.defineProperty(r,e,a),a};Object.defineProperty(e,"__esModule",{value:!0});var a,c=cc._decorator,s=c.ccclass,h=c.property,d=["\u6563\u724c","\u5c0d\u5b50","\u4e09\u689d"],l=["\u6563\u724c","\u4e00\u5c0d","\u5169\u5c0d","\u4e09\u689d","\u9806\u5b50","\u540c\u82b1","\u846b\u8606","\u56db\u689d","\u540c\u82b1\u9806"],p=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.cardsbg=null,r.cardsample=null,r.mainnode=null,r.roomnode=null,r.namenode=null,r.roombtnnode=null,r.roomviewnode=null,r.cardlayout=[],r.deckbtn1=null,r.deckbtn2=null,r.deckbtn3=null,r.joingamebtn=null,r.joinroombtn=null,r.exitroombtn=null,r.exitlobbybtn=null,r.nameedb=null,r.roomedb=null,r.winnerlabel=null,r.timerlabel=null,r.cmpstatelabel=null,r.personcount=null,r.plabel=[],r.cardarray=[],r.cardtemp=[],r.scorearray=[12,0,1,2,3,4,5,6,7,8,9,10,11],r.gamestarted=!1,r.roombtnnodearray=[],r.yourname="",r.yourseat=0,r}return i(r,t),r.prototype.initmainnode=function(){for(var t=0;t<4;t++)this.cardarray.push([]);for(this.deckbtn1.node.on("click",this.deck1clicked,this),this.deckbtn2.node.on("click",this.deck2clicked,this),this.deckbtn3.node.on("click",this.deck3clicked,this),t=0;t<52;t++){var r=cc.instantiate(this.cardsample);r.name=(t%13).toString(),r.y=0,3==Math.floor(t/13)?r.on("click",this.playercardclicked,this):r.getComponent(cc.Button).interactable=!1,r.active=!1,r.parent=this.cardlayout[Math.floor(t/13)].node}this.setdeck(),this.exitlobbybtn.node.on("click",this.ExitLobbySendToServer,this)},r.prototype.initroomnode=function(){this.roomnode.x=0,this.joinroombtn.node.on("click",this.joinroomclicked,this),this.exitroombtn.node.on("click",this.ExitRoomSendToServer,this)},r.prototype.initnamenode=function(){this.namenode.x=0,this.joingamebtn.node.on("click",this.joingameclicked,this)},r.prototype.initconnect=function(){var t=prompt("Server IP:");this.SetUpServer(t)},r.prototype.start=function(){this.initmainnode(),this.initroomnode(),this.initnamenode(),this.mainnode.active=!1,this.roomnode.active=!1,this.namenode.active=!1,this.initconnect()},r.prototype.playercardclicked=function(t){0==t.node.y?t.node.y=20:t.node.y=0},r.prototype.deck1clicked=function(){if(0==this.cardarray[0].length){if(this.getslectedcard(),5==this.cardtemp.length)for(var t=0;t<5;t++)this.cardarray[0].push(this.cardtemp[t]),this.cardarray[3].splice(this.cardarray[3].indexOf(this.cardtemp[t]),1);this.cardrender(!0)}else{for(t=0;t<5;t++)this.cardarray[3].push(this.cardarray[0][t]);this.cardarray[0]=[],this.cardrender(!0)}this.SetCardSendToServer()},r.prototype.deck2clicked=function(){if(0==this.cardarray[1].length){if(this.getslectedcard(),3==this.cardtemp.length)for(var t=0;t<3;t++)this.cardarray[1].push(this.cardtemp[t]),this.cardarray[3].splice(this.cardarray[3].indexOf(this.cardtemp[t]),1);this.cardrender(!0)}else{for(t=0;t<3;t++)this.cardarray[3].push(this.cardarray[1][t]);this.cardarray[1]=[],this.cardrender(!0)}this.SetCardSendToServer()},r.prototype.deck3clicked=function(){if(0==this.cardarray[2].length){if(this.getslectedcard(),5==this.cardtemp.length)for(var t=0;t<5;t++)this.cardarray[2].push(this.cardtemp[t]),this.cardarray[3].splice(this.cardarray[3].indexOf(this.cardtemp[t]),1);this.cardrender(!0)}else{for(t=0;t<5;t++)this.cardarray[3].push(this.cardarray[2][t]);this.cardarray[2]=[],this.cardrender(!0)}this.SetCardSendToServer()},r.prototype.joingameclicked=function(){var t=this.nameedb.string;this.yourname=t,this.JoinGameSendToServer(t)},r.prototype.joinroombtnclicked=function(t){this.JoinRoomSendToServer(t)},r.prototype.joinroomclicked=function(){var t=this.roomedb.string;this.JoinRoomSendToServer(t)},r.prototype.getslectedcard=function(){this.cardtemp=[];for(var t=0;t<this.cardarray[3].length;t++)20==this.cardlayout[3].node.getChildByName(t.toString()).y&&this.cardtemp.push(this.cardarray[3][t])},r.prototype.setdeck=function(t){void 0===t&&(t=[0,1,2,3,4,5,6,7,8,9,10,11,12]),this.cardarray[0]=[],this.cardarray[1]=[],this.cardarray[2]=[],this.cardarray[3]=t,this.cardrender()},r.prototype.cardrender=function(t){void 0===t&&(t=!1);for(var r=0;r<4;r++)for(var e=0;e<13;e++){var o=this.cardlayout[r].node.getChildByName(e.toString());this.cardarray[r].sort(function(t,r){return t-r}),t&&(o.y=0),e<this.cardarray[r].length?(o.active=!0,o.getComponentInChildren(cc.Sprite).spriteFrame=this.cardsbg.getSpriteFrame((this.cardarray[r][e]+1).toString())):o.active=!1}},r.prototype.roomrender=function(){var t=this;cc.log(this.roomtemp);for(var r=0;r<this.roombtnnodearray.length;r++)this.roombtnnodearray[r].destroy();this.roombtnnodearray=[],this.roomviewnode.setContentSize(new cc.Size(220,60*this.roomtemp.length));var e=function(r){var e=o.getpersoncount(o.roomtemp[r]),i=cc.instantiate(o.roombtnnode);i.parent=o.roomviewnode,i.x=0,i.y=-i.getContentSize().height/2-i.getContentSize().height*r,i.getComponentInChildren(cc.Label).string=o.roomtemp[r].Name+"\t"+e.toString()+"p",4==e&&(i.getComponent(cc.Button).interactable=!1),i.on("click",function(){t.joinroombtnclicked(t.roomtemp[r].Name)},o),o.roombtnnodearray.push(i)},o=this;for(r=0;r<this.roomtemp.length;r++)e(r)},r.prototype.getpersoncount=function(t){for(var r=0,e=0;e<t.Players.length;e++)""!=t.Players[e]&&(t.Players[e]==this.yourname&&(this.yourseat=e),r++);return r},r.prototype.setdeckclickable=function(t){this.deckbtn1.interactable=t,this.deckbtn2.interactable=t,this.deckbtn3.interactable=t;for(var r=0;r<13;r++)this.cardlayout[3].node.getChildByName(r.toString()).getComponent(cc.Button).interactable=t},r.prototype.startpersentation=function(t,r){var e=this,o=0,i=-1,n=0;if(this.plabel[0].string="you ",this.plabel[3].string=this.roomtemp[0].Players[(this.yourseat+1)%4]+" ",this.plabel[2].string=this.roomtemp[0].Players[(this.yourseat+2)%4]+" ",this.plabel[1].string=this.roomtemp[0].Players[(this.yourseat+3)%4]+" ",0==t){this.exitroombtn.interactable=!1,(p=this.deckbtn1.disabledColor).a=0,this.deckbtn1.disabledColor=p,this.deckbtn2.disabledColor=p,this.deckbtn3.disabledColor=p;for(var a=0;a<4;a++)if(this.cardarray[a]=r[(this.yourseat+1+a)%4].slice(0,3).sort(function(t,r){return t-r}),o=this.getscore(this.cardarray[a]),this.plabel[3-a].string+=d[o],o>i)n=a,i=o;else if(o==i){for(var c=[],s=[],h=0;h<this.cardarray[a].length;h++)c.push(this.scorearray[this.cardarray[n][h]%13]),s.push(this.scorearray[this.cardarray[a][h]%13]);for(c=c.sort(function(t,r){return t-r}),s=s.sort(function(t,r){return t-r}),h=this.cardarray[a].length-1;h>=0;h--){if(s[h]>c[h]){n=a;break}if(s[h]<c[h])break}}this.winnerlabel.string=3-n==0?"Winner: YOU!!":"Winner: player"+(3-n).toString(),this.cmpstatelabel.string="\u982d\uff01",this.cmpstatelabel.node.getComponent(cc.Animation).play("cmpstateclip"),this.cardrender(!0),this.scheduleOnce(function(){e.startpersentation.bind(e)(t+1,r)},4)}else if(1==t){for(a=0;a<4;a++)if(this.cardarray[a]=r[(this.yourseat+1+a)%4].slice(3,8).sort(function(t,r){return t-r}),o=this.getscore(this.cardarray[a]),this.plabel[3-a].string+=l[o],o>i)n=a,i=o;else if(o==i){for(c=[],s=[],h=0;h<this.cardarray[a].length;h++)c.push(this.scorearray[this.cardarray[n][h]%13]),s.push(this.scorearray[this.cardarray[a][h]%13]);for(c=c.sort(function(t,r){return t-r}),s=s.sort(function(t,r){return t-r}),h=this.cardarray[a].length-1;h>=0;h--){if(s[h]>c[h]){n=a;break}if(s[h]<c[h])break}}this.winnerlabel.string=3-n==0?"Winner: YOU!!":"Winner: player"+(3-n).toString(),this.cmpstatelabel.string="\u4e8c\u9053",this.cmpstatelabel.node.getComponent(cc.Animation).play("cmpstateclip"),this.cardrender(!0),this.scheduleOnce(function(){e.startpersentation.bind(e)(t+1,r)},4)}else if(2==t){for(a=0;a<4;a++)if(this.cardarray[a]=r[(this.yourseat+1+a)%4].slice(8).sort(function(t,r){return t-r}),o=this.getscore(this.cardarray[a]),this.plabel[3-a].string+=l[o],o>i)n=a,i=o;else if(o==i){for(c=[],s=[],h=0;h<this.cardarray[a].length;h++)c.push(this.scorearray[this.cardarray[n][h]%13]),s.push(this.scorearray[this.cardarray[a][h]%13]);for(c=c.sort(function(t,r){return t-r}),s=s.sort(function(t,r){return t-r}),h=this.cardarray[a].length-1;h>=0;h--){if(s[h]>c[h]){n=a;break}if(s[h]<c[h])break}}this.winnerlabel.string=3-n==0?"Winner: YOU!!":"Winner: player"+(3-n).toString(),this.cmpstatelabel.string="\u5c3e",this.cmpstatelabel.node.getComponent(cc.Animation).play("cmpstateclip"),this.cardrender(!0),this.scheduleOnce(function(){e.startpersentation.bind(e)(t+1,r)},4)}else if(3==t){var p;this.plabel[0].string="\u624b\u724c",this.plabel[1].string="\u5c3e",this.plabel[2].string="\u982d",this.plabel[3].string="\u4e8c\u9053",this.winnerlabel.string="",this.cmpstatelabel.string="",this.exitroombtn.interactable=!0,(p=this.deckbtn1.disabledColor).a=200,this.deckbtn1.disabledColor=p,this.deckbtn2.disabledColor=p,this.deckbtn3.disabledColor=p,this.setdeck()}},r.prototype.getscore=function(t){return 5==t.length?this.is\u540c\u82b1\u9806(t)?8:this.is\u56db\u689d(t)?7:this.is\u846b\u8606(t)?6:this.is\u540c\u82b1(t)?5:this.is\u9806\u5b50(t)?4:this.is\u4e09\u689d(t)?3:this.is\u5169\u5c0d(t)?2:this.is\u4e00\u5c0d(t)?1:0:this.is\u4e09\u689d(t)?2:this.is\u4e00\u5c0d(t)?1:0},r.prototype.is\u540c\u82b1\u9806=function(t){return Math.floor(t[0]/13)==Math.floor(t[4]/13)&&t[1]==t[2]-1&&t[1]==t[3]-2&&t[1]==t[4]-3&&(t[1]-1==t[0]&&t[0]%13!=0||t[0]%13==0&&t[4]%13==12)},r.prototype.is\u56db\u689d=function(t){var r=[t[0]%13,t[1]%13,t[2]%13,t[3]%13,t[4]%13];return 4==this.countarr(r,r[0])||4==this.countarr(r,r[1])},r.prototype.is\u846b\u8606=function(t){for(var r=[t[0]%13,t[1]%13,t[2]%13,t[3]%13,t[4]%13],e=this.countarr(r,r[0]),o=0,i=0;i<3;i++)if(r[0]!=r[i+1]){o=this.countarr(r,r[i+1]);break}return 3==e&&2==o||2==e&&3==o},r.prototype.is\u540c\u82b1=function(t){return Math.floor(t[0]/13)==Math.floor(t[1]/13)&&Math.floor(t[0]/13)==Math.floor(t[2]/13)&&Math.floor(t[0]/13)==Math.floor(t[3]/13)&&Math.floor(t[0]/13)==Math.floor(t[4]/13)},r.prototype.is\u9806\u5b50=function(t){var r=[t[0]%13,t[1]%13,t[2]%13,t[3]%13,t[4]%13].sort(function(t,r){return t-r});return r[1]==r[2]-1&&r[1]==r[3]-2&&r[1]==r[4]-3&&(r[1]-1==r[0]&&0!=r[0]||0==r[0]&&12==r[4])},r.prototype.is\u4e09\u689d=function(t){var r=[t[0]%13,t[1]%13,t[2]%13];return 3==this.countarr(r,r[0])||3==this.countarr(r,r[1])||3==this.countarr(r,r[2])},r.prototype.is\u5169\u5c0d=function(t){var r=[t[0]%13,t[1]%13,t[2]%13,t[3]%13,t[4]%13],e=0,o=this.countarr(r,r[0]);if(2!=o&&(e=1,2!=(o=this.countarr(r,r[1]))))return!1;for(var i=0,n=e;n<3;n++)if(r[e]!=r[n+1]){i=this.countarr(r,r[n+1]);break}return 2==i},r.prototype.is\u4e00\u5c0d=function(t){var r=(t[0],t[1],t[2],t[3],t[4]);r=5==t.length?[t[0]%13,t[1]%13,t[2]%13,t[3]%13,t[4]%13]:[t[0]%13,t[1]%13,t[2]%13];for(var e=0;e<t.length-1;e++)if(2==this.countarr(r,r[e]))return!0;return!1},r.prototype.countarr=function(t,r){for(var e=0,o=0;o<t.length;o++)t[o]==r&&e++;return e},r.prototype.fillcard=function(){3!=this.cardarray[1].length&&(this.cardarray[1]=this.cardarray[1].concat(this.cardarray[3].slice(0,3)),this.cardarray[3]=this.cardarray[3].slice(3)),5!=this.cardarray[0].length&&(this.cardarray[0]=this.cardarray[0].concat(this.cardarray[3].slice(0,5)),this.cardarray[3]=this.cardarray[3].slice(5)),5!=this.cardarray[2].length&&(this.cardarray[2]=this.cardarray[2].concat(this.cardarray[3].slice(0,5)),this.cardarray[3]=this.cardarray[3].slice(5)),this.cardrender()},r.prototype.timerstart=function(t){var r=this;void 0===t&&(t=25),this.timerlabel.string=t.toString(),t>0?this.scheduleOnce(function(){r.timerstart(t-1)},1):(this.timerlabel.string="",this.fillcard(),this.setdeckclickable(!1))},r.prototype.ReceivedFromServer=function(t){cc.log("Received data!");var r=JSON.parse(t);switch(cc.log("Type:",r.Type),r.Type){case"LocationMsg":0==r.Location?(this.mainnode.active=!1,this.roomnode.active=!1,this.namenode.active=!0):1==r.Location?(this.mainnode.active=!1,this.roomnode.active=!0,this.namenode.active=!1):(this.mainnode.active=!0,this.roomnode.active=!1,this.namenode.active=!1);break;case"RoomMsg":r.Rooms!=this.roomtemp&&(this.roomtemp=r.Rooms,this.roomrender()),r.Rooms.length>0&&(4!=this.getpersoncount(r.Rooms[0])&&this.setdeckclickable(!1),this.personcount.string="\u76ee\u524d\u623f\u9593\u4eba\u6578\uff1a "+this.getpersoncount(r.Rooms[0]).toString()+" \u4eba");break;case"CardMsg":-1==r.Cards[(this.yourseat+1)%4][0]?this.gamestarted||(this.timerstart(),this.setdeck(r.Cards[this.yourseat]),this.gamestarted=!0,this.setdeckclickable(!0)):this.gamestarted&&(this.setdeckclickable(!1),this.gamestarted=!1,this.startpersentation(0,r.Cards))}},r.prototype.JoinGameSendToServer=function(t){var r=new Object;r.Type="join.lobby",r.Name=t,this.SendToServerPack(r)},r.prototype.JoinRoomSendToServer=function(t){var r=new Object;r.Type="join.room",r.Name=t,this.SendToServerPack(r)},r.prototype.ExitRoomSendToServer=function(){var t=new Object;t.Type="exit.room",this.SendToServerPack(t)},r.prototype.ExitLobbySendToServer=function(){var t=new Object;t.Type="exit.lobby",this.SendToServerPack(t)},r.prototype.SetCardSendToServer=function(){var t=new Object;t.Type="set.card";var r=[],e=0;3==this.cardarray[1].length?r=r.concat(this.cardarray[1]):(r=r.concat(this.cardarray[3].slice(e,e+3)),e+=3),5==this.cardarray[0].length?r=r.concat(this.cardarray[0]):(r=r.concat(this.cardarray[3].slice(e,e+5)),e+=5),5==this.cardarray[2].length?r=r.concat(this.cardarray[2]):(r=r.concat(this.cardarray[3].slice(e,e+5)),e+=5),t.Cards=r,this.SendToServerPack(t)},r.prototype.SendToServerPack=function(t){this.SendToServer(new Uint8Array(this.string2Bin(JSON.stringify(t))))},r.prototype.SendToServer=function(t){a.send(t)},r.prototype.SetUpServerProxy=function(){cc.log("Reconnecting..."),this.SetUpServer("")},r.prototype.SetUpServer=function(t){var r=this;try{a=new WebSocket("wss://"+t+"/")}catch(c){return}a.binaryType="arraybuffer",a.onopen=function(){r.unschedule(r.SetUpServerProxy),cc.log("Connection open ..."),r.namenode.active=!0},a.onmessage=function(t){r.ReceivedFromServer(t.data)},a.onerror=function(t){console.error("WebSocket error observed:"+t)},a.onclose=function(){cc.log("Connection closed.")}},r.prototype.string2Bin=function(t){for(var r=[],e=0;e<t.length;e++)r.push(t.charCodeAt(e));return r},r.prototype.bin2String=function(t){for(var r="",e=0;e<t.length;e++)r+=String.fromCharCode(t[e]);return r},r.prototype.GetIntBytes=function(t){var r=[],e=0;do{r[e++]=255&t,t>>=8}while(e<1);return r},r.prototype.GetBytesInt=function(t){for(var r=0,e=0;e<t.length;++e)r+=t[e]<<8*e;return r},r.prototype.PackNumber=function(t){var r="p";t<=0&&(t*=-1,r="n");var e=this.GetIntBytes(t),o=this.string2Bin(r);return o.concat(e)},r.prototype.UnpackNumber=function(t){var r=1;return"n"==this.bin2String(t[0])&&(r=-1),t=t.slice(1),this.GetBytesInt(t)*r},r.prototype.EncodeData=function(t){for(var r=[],e=0;e<t.length;e++)r=r.concat(this.PackNumber(t[e]));return r},r.prototype.DecodeData=function(t){for(var r=[];t.length>0;)r.push(this.UnpackNumber(t.slice(0,2))),t=t.slice(2);return new Uint8Array(r)},n([h(cc.SpriteAtlas)],r.prototype,"cardsbg",void 0),n([h(cc.Node)],r.prototype,"cardsample",void 0),n([h(cc.Node)],r.prototype,"mainnode",void 0),n([h(cc.Node)],r.prototype,"roomnode",void 0),n([h(cc.Node)],r.prototype,"namenode",void 0),n([h(cc.Node)],r.prototype,"roombtnnode",void 0),n([h(cc.Node)],r.prototype,"roomviewnode",void 0),n([h(cc.Layout)],r.prototype,"cardlayout",void 0),n([h(cc.Button)],r.prototype,"deckbtn1",void 0),n([h(cc.Button)],r.prototype,"deckbtn2",void 0),n([h(cc.Button)],r.prototype,"deckbtn3",void 0),n([h(cc.Button)],r.prototype,"joingamebtn",void 0),n([h(cc.Button)],r.prototype,"joinroombtn",void 0),n([h(cc.Button)],r.prototype,"exitroombtn",void 0),n([h(cc.Button)],r.prototype,"exitlobbybtn",void 0),n([h(cc.EditBox)],r.prototype,"nameedb",void 0),n([h(cc.EditBox)],r.prototype,"roomedb",void 0),n([h(cc.Label)],r.prototype,"winnerlabel",void 0),n([h(cc.Label)],r.prototype,"timerlabel",void 0),n([h(cc.Label)],r.prototype,"cmpstatelabel",void 0),n([h(cc.Label)],r.prototype,"personcount",void 0),n([h(cc.Label)],r.prototype,"plabel",void 0),n([s],r)}(cc.Component);e.default=p,cc._RF.pop()},{}]},{},["main"]);
//# sourceMappingURL=index.js.map
